---
const { name, brand, price, image, description, available, stock } =
    Astro.props;
---

<div
    class="group flex h-full flex-col overflow-hidden rounded-2xl bg-white transition-all duration-300 ease-out hover:shadow-xl shadow-sm border border-gray-100/50"
>
    <div class="relative aspect-[3/3] overflow-hidden bg-gray-50">
        <img
            src={image}
            alt={name}
            loading="lazy"
            class="h-full w-full object-cover transition-transform duration-700 ease-out group-hover:scale-105"
        />
    </div>

    <div class="flex grow flex-col p-6">
        <div class="mb-4">
            <p
                class="mb-1 text-[10px] font-bold tracking-widest uppercase text-gray-400"
            >
                {brand}
            </p>
            <h3 class="text-xl font-semibold text-gray-900 leading-tight">
                {name}
            </h3>
        </div>

        <p class="mb-6 line-clamp-3 text-sm leading-relaxed text-gray-500">
            {description}
        </p>

        <div
            class="mt-auto flex items-end justify-between border-t border-gray-100 pt-4"
        >
            <div class="flex flex-col">
                {
                    available && stock > 0 ? (
                        <>
                            <span class="text-lg font-medium text-gray-900">
                                ${price.toLocaleString("es-CL")}
                            </span>
                            {stock <= 5 && (
                                <span class="text-[10px] font-medium text-amber-500">
                                    ¡Solo quedan {stock}!
                                </span>
                            )}
                        </>
                    ) : (
                        <span class="text-base font-medium text-red-500">
                            Agotado
                        </span>
                    )
                }
            </div>
            <div class="flex gap-2">
                <a
                    class="rounded-full bg-gray-100 px-4 py-1.5 text-xs font-medium text-gray-900 transition-all duration-300 hover:bg-gray-200 active:scale-95"
                    href={`/${name}`}
                >
                    Detalles
                </a>
                <button
                    class="add-to-cart-btn flex-1 rounded-full bg-black px-4 py-1.5 text-xs font-medium text-white transition-all duration-300 hover:bg-gray-800 hover:shadow-lg active:scale-95 cursor-pointer"
                    data-id={name}
                    data-name={name}
                    data-price={price}
                    data-image={image}
                    data-brand={brand}
                    disabled={!available || stock <= 0}
                >
                    {available && stock > 0 ? "Añadir" : "Agotado"}
                </button>
            </div>
        </div>
    </div>
</div>

<script>
    import { addToCart } from "../store/cartStore";

    const buttons = document.querySelectorAll(".add-to-cart-btn");
    buttons.forEach((button) => {
        button.addEventListener("click", (e) => {
            const btn = e.currentTarget as HTMLButtonElement;
            const product = {
                id: btn.dataset.id!,
                name: btn.dataset.name!,
                price: parseFloat(btn.dataset.price!),
                image: btn.dataset.image!,
                brand: btn.dataset.brand,
            };
            addToCart(product);
        });
    });
</script>
