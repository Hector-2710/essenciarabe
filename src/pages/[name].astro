---
import Layout from "../layouts/MainLayout.astro";
import Navbar from "../components/Navbar.astro";
import { getCollection } from "astro:content";

export async function getStaticPaths() {
    const perfumes = await getCollection("perfumes");
    const decants = await getCollection("decants");

    const perfumePaths = perfumes.map((perfume) => ({
        params: { name: perfume.data.name },
        props: { data: perfume.data, category: "Perfume" },
    }));

    const decantPaths = decants.map((decant) => ({
        params: { name: decant.data.name },
        props: { data: decant.data, category: "Decant" },
    }));

    return [...perfumePaths, ...decantPaths];
}

const { data, category } = Astro.props;
const { name, brand, price, image, description, available, stock } = data;
---

<Layout title={`${name} | Essenciarabe`}>
    <Navbar />

    <main class="bg-[#f5f5f7] text-[#1d1d1f] font-['Outfit']">
        <section class="max-w-[1100px] mx-auto px-8 py-4 lg:py-8">
            <!-- Back Button -->
            <div class="mb-8">
                <a
                    href="/"
                    class="inline-flex items-center gap-2 px-6 py-2.5 bg-white rounded-full text-black font-semibold shadow-[0_2px_10px_rgba(0,0,0,0.05)] border border-[#e5e5e7] hover:bg-[#f5f5f7] hover:shadow-[0_4px_15px_rgba(0,0,0,0.1)] transition-all duration-300 group"
                >
                    <svg
                        xmlns="http://www.w3.org/2000/svg"
                        width="18"
                        height="18"
                        viewBox="0 0 24 24"
                        fill="none"
                        stroke="currentColor"
                        stroke-width="2.5"
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        class="transition-transform group-hover:-translate-x-1"
                        ><path d="m15 18-6-6 6-6"></path></svg
                    >
                    Volver al inicio
                </a>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 items-stretch">
                <!-- Image Section -->
                <div class="relative group">
                    <img
                        src={image}
                        alt={name}
                        class="w-full h-full object-cover rounded-[2rem] z-10 shadow-2xl transition-transform duration-700 ease-[cubic-bezier(0.16,1,0.3,1)] group-hover:scale-105"
                    />
                    <div
                        class="absolute inset-0 bg-[radial-gradient(circle,_rgba(212,175,55,0.08)_0%,_transparent_70%)] blur-[40px] z-0 pointer-events-none"
                    >
                    </div>
                </div>

                <!-- Info Section -->
                <div
                    class="p-8 bg-white rounded-[2rem] shadow-sm animate-fadeInUp flex flex-col justify-center"
                >
                    <div class="mb-8">
                        <span
                            class="text-[0.9rem] uppercase tracking-[0.2em] text-[#d4af37] font-semibold"
                            >{brand}</span
                        >
                        <h1
                            class="text-[3.5rem] font-bold mt-2 mb-0 leading-[1.1] text-[#1d1d1f] tracking-tight"
                        >
                            {name}
                        </h1>
                        <p class="text-[1.2rem] text-[#86868b] mt-2">
                            {category}
                        </p>
                    </div>

                    <div class="flex items-center gap-6 mb-8">
                        <span class="text-[2rem] font-semibold text-[#1d1d1f]"
                            >${price.toLocaleString()}</span
                        >
                        {
                            available ? (
                                <span class="px-4 py-1.5 rounded-full text-[0.8rem] font-semibold bg-green-50 text-green-700 border border-green-100">
                                    En stock
                                </span>
                            ) : (
                                <span class="px-4 py-1.5 rounded-full text-[0.8rem] font-semibold bg-red-50 text-red-700 border border-red-100">
                                    Agotado
                                </span>
                            )
                        }
                    </div>

                    <div
                        class="mb-10 text-[1.1rem] leading-relaxed text-[#424245]"
                    >
                        <p>
                            {
                                description ||
                                    "Una fragancia excepcional seleccionada por Essenciarabe para aquellos que buscan distinción y elegancia."
                            }
                        </p>
                    </div>

                    <div class="mb-12">
                        <button
                            id="add-to-cart-btn"
                            class="w-full p-5 rounded-2xl border-none bg-[#0071e3] text-white text-[1.1rem] font-semibold cursor-pointer transition-all duration-300 hover:bg-[#0077ed] hover:-translate-y-0.5 disabled:bg-[#86868b] disabled:opacity-50 disabled:cursor-not-allowed"
                            disabled={!available}
                            data-id={name}
                            data-name={name}
                            data-brand={brand}
                            data-price={price}
                            data-image={image}
                        >
                            {available ? "Agregar al carrito" : "Próximamente"}
                        </button>
                    </div>

                    <div
                        class="grid grid-cols-2 gap-6 pt-8 border-t border-[#e5e5e7]"
                    >
                        <div class="flex flex-col gap-1">
                            <span
                                class="text-[0.8rem] text-[#86868b] uppercase font-semibold tracking-wider"
                                >Disponibilidad</span
                            >
                            <span class="font-semibold text-[#1d1d1f]"
                                >{stock} unidades</span
                            >
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </main>
</Layout>

<script>
    import { addToCart } from "../store/cartStore";

    const addToCartBtn = document.getElementById("add-to-cart-btn");

    addToCartBtn?.addEventListener("click", () => {
        const dataset = (addToCartBtn as HTMLButtonElement).dataset;
        addToCart({
            id: dataset.id || "",
            name: dataset.name || "",
            brand: dataset.brand || "",
            price: Number(dataset.price) || 0,
            image: dataset.image || "",
        });
    });
</script>
